---
title: "p8105_fp_mjcr"
output: github_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(httr)
library(rvest)
library(openintro)


```

Download data:

```{r, cache = TRUE, message = FALSE}
#cdc_df = GET("https://chronicdata.cdc.gov/resource/ta23-kdpu.csv") %>%
#  content("parsed") 

cdc_df = read_csv("./data/500_Cities__City-level_Data__GIS_Friendly_Format___2016_release.csv")

```

Select variables we may be interested in:

```{r}

cdc_df = cdc_df %>%
  select(c(StateAbbr, PlaceName, Population2010, ACCESS2_CrudePrev, ACCESS2_AdjPrev, BPHIGH_CrudePrev, BPHIGH_AdjPrev, BPMED_CrudePrev, BPMED_AdjPrev, CANCER_CrudePrev, CANCER_AdjPrev, CHD_CrudePrev, CHD_AdjPrev, CHECKUP_CrudePrev, CHECKUP_AdjPrev, CHOLSCREEN_CrudePrev, CHOLSCREEN_AdjPrev, COLON_SCREEN_CrudePrev, COLON_SCREEN_AdjPrev, COPD_CrudePrev, COPD_AdjPrev, COREM_CrudePrev, COREM_AdjPrev, COREW_CrudePrev, COREW_AdjPrev, DENTAL_CrudePrev, DENTAL_AdjPrev, DIABETES_CrudePrev, DIABETES_AdjPrev, HIGHCHOL_CrudePrev, HIGHCHOL_AdjPrev, LPA_CrudePrev, LPA_AdjPrev, MAMMOUSE_CrudePrev, MAMMOUSE_AdjPrev, OBESITY_CrudePrev, OBESITY_AdjPrev, PAPTEST_CrudePrev, PAPTEST_AdjPrev, PHLTH_CrudePrev, PHLTH_AdjPrev, STROKE_CrudePrev, STROKE_AdjPrev, Geolocation)) %>% 
  mutate(state = abbr2state(StateAbbr)) %>%
  select(state, everything())

```

Merge data on state expenditure on healthcare:

```{r, message = FALSE}
#link: https://www.kff.org/other/state-indicator/health-spending-per-capita/?currentTimeframe=0&sortModel=%7B%22colId%22:%22Location%22,%22sort%22:%22asc%22%7D

#Importing the raw expenditure data set and cleaning
healthcare_exp_df = read_csv("./data/health_care_expenditure.csv", 
                             skip = 4, n_max = 50, col_names = F) %>%
  rename(state = "X1", health_exp = "X2") %>%
  mutate(health_exp = str_replace(health_exp, "\\$", ""),
         health_exp  = as.numeric(health_exp))


#Add state healthcare expenditure data to CDC data
cdc_df = left_join(cdc_df, healthcare_exp_df, by = "state")

cdc_df = cdc_df %>% mutate(state = abbr2state(StateAbbr))

```


Merge data regions per state:

```{r, message = FAlSE}
regions_df = read_csv("https://raw.githubusercontent.com/cphalpert/census-regions/master/us%20census%20bureau%20regions%20and%20divisions.csv") %>%
  janitor::clean_names() %>%
  select(-state_code)
  

cdc_df = left_join(cdc_df, regions_df, by = "state")
```









